# Architecture

**Analysis Date:** 2026-01-18

## Pattern Overview

**Overall:** Component-Based Single Page Application (SPA) with Offline-First Data Layer

**Key Characteristics:**
- Offline-first PWA using IndexedDB (Dexie) for all data persistence
- Hash-based routing with React Router for navigation
- Bot system abstraction for domain-specific logic (recipe adaptation, meal planning)
- Two-person user model (Elvis & Alberina) with per-user data filtering

## Layers

**Presentation Layer (Pages):**
- Purpose: Feature-specific UI pages with local state and data fetching
- Location: `Der-Stille-Helfer-Original-31/src/pages/`
- Contains: React functional components with corresponding CSS modules
- Depends on: Data layer (`db/schema`), Bot layer (`bots/`), Components
- Used by: App router

**Component Layer:**
- Purpose: Shared UI components (layout shell, PWA prompts)
- Location: `Der-Stille-Helfer-Original-31/src/components/`
- Contains: Layout wrapper, PWA update notification
- Depends on: React Router (Link), strings
- Used by: Pages, App

**Data Layer:**
- Purpose: IndexedDB persistence via Dexie ORM
- Location: `Der-Stille-Helfer-Original-31/src/db/`
- Contains: Database schema definition, helper query functions
- Depends on: Dexie library
- Used by: Pages (via `useLiveQuery` hook)

**Bot Layer:**
- Purpose: Domain logic for recipe safety checking and meal suggestions
- Location: `Der-Stille-Helfer-Original-31/src/bots/`
- Contains: Base Bot class, KochBot (recipe adaptation), PlanerBot (suggestions)
- Depends on: None (pure logic)
- Used by: Pages (Uebersicht)

**Localization Layer:**
- Purpose: German UI strings centralized for i18n
- Location: `Der-Stille-Helfer-Original-31/src/strings/de.js`
- Contains: Nested string objects by feature area
- Depends on: None
- Used by: Components, Pages (partially)

## Data Flow

**User Interaction Flow:**

1. User navigates via bottom nav (Layout component)
2. React Router renders appropriate page component
3. Page uses `useLiveQuery()` hook to subscribe to IndexedDB data
4. User actions trigger direct Dexie operations (`db.table.add()`, `.delete()`, `.update()`)
5. Dexie live queries automatically re-render component with updated data

**Bot Suggestion Flow:**

1. Uebersicht page loads product inventory via `useLiveQuery`
2. `useEffect` passes products to `bots.planer.suggest()`
3. PlanerBot analyzes products and returns suggestion (or null)
4. Suggestion displayed in highlight card if present

**State Management:**
- No global state management library (Redux, Zustand, etc.)
- Local component state via `useState` for form inputs and UI state
- Persistent data entirely in IndexedDB accessed via Dexie hooks
- User context currently hardcoded (`activeUser = 'elvis'`)

## Key Abstractions

**Database Tables:**
- Purpose: Core data entities for kitchen management
- Examples: `db.produkte`, `db.base_rezepte`, `db.einkaufsliste`, `db.favoriten`, `db.notizen`
- Pattern: All tables use string `id` (timestamp-based) with `person_id` for user ownership

**Bot Base Class:**
- Purpose: Extensible assistant/helper pattern
- Examples: `Der-Stille-Helfer-Original-31/src/bots/Bot.js`
- Pattern: Base class with id/name/icon, subclasses implement domain methods

**Page Component:**
- Purpose: Self-contained feature module
- Examples: `Der-Stille-Helfer-Original-31/src/pages/ProdukteListe.jsx`, `Der-Stille-Helfer-Original-31/src/pages/EinkaufsListe.jsx`
- Pattern: Component queries own data, manages own form state, direct DB operations inline

## Entry Points

**Application Entry:**
- Location: `Der-Stille-Helfer-Original-31/index.html`
- Triggers: Browser load
- Responsibilities: HTML shell, loads React app via `/src/main.jsx`

**React Bootstrap:**
- Location: `Der-Stille-Helfer-Original-31/src/main.jsx`
- Triggers: Module import from index.html
- Responsibilities: Creates React root, renders App component in StrictMode

**Router Root:**
- Location: `Der-Stille-Helfer-Original-31/src/App.jsx`
- Triggers: React render
- Responsibilities: Defines all routes, wraps pages in Layout, redirects `/` to `/uebersicht`

**PWA Service Worker:**
- Location: Generated by vite-plugin-pwa at build time
- Triggers: Browser service worker registration
- Responsibilities: Caches assets, enables offline functionality, auto-updates

## Error Handling

**Strategy:** Minimal explicit error handling; relies on React error boundaries (not implemented) and browser defaults

**Patterns:**
- Database operations use async/await without try/catch
- Form validation is basic (empty string checks only)
- No error boundaries defined
- Alert() used for user feedback in BackupExport

## Cross-Cutting Concerns

**Logging:** None implemented (uses browser console implicitly)

**Validation:** Inline checks in event handlers (e.g., `if (!name) return`)

**Authentication:** Not applicable (local-only app, user selection is UI-level)

**Theming:** CSS custom properties (`--color-bg`, `--color-text`) for dark mode support

**Offline Support:** Handled entirely by Dexie (IndexedDB) and Workbox service worker (vite-plugin-pwa)

---

*Architecture analysis: 2026-01-18*
