# External Integrations

**Analysis Date:** 2026-01-24

## APIs & External Services

**None - Offline-First Architecture**

This application is designed as a fully offline-first PWA with no external API dependencies. All data is stored locally in the browser's IndexedDB and no network requests are made to any external services.

## Data Storage

**Databases:**
- IndexedDB (browser-native, per-origin isolation)
  - Database name: `DerStilleHelfer`
  - Wrapper: Dexie ^4.0.1
  - Connection: Automatic, no credentials required
  - Client code: `src/db/schema.js`
  - Helpers: `src/db/helpers.js`

**Database Schema (12 tables):**

Located in `src/db/schema.js`, defined as Dexie table configuration:

```javascript
personen:         'id, name, aktiv'                          // User profiles (Elvis, Alberina)
produkte:         'id, person_id, name, kategorie, ablauf, ort'  // Kitchen inventory items
base_rezepte:     'id, name, kategorie, k√ºche, quelle, anleitung, portionen, zeit, *zutaten, *tags'  // System recipes
eigene_rezepte:   'id, person_id, name, kategorie, k√ºche, anleitung, portionen, created_at, zeit, *zutaten, *tags'  // User-created recipes
varianten:        'id, person_id, base_rezept_id, *√§nderungen, approved, created_at'  // Recipe modifications
favoriten:        'id, person_id, rezept_type, rezept_id, starred_at'  // Favorite recipes
einkaufsliste:    'id, person_id, name, menge, checked, kategorie, created_at'  // Shopping list
notizen:          'id, person_id, titel, created_at'         // User notes
profile:          'id, person_id, dietary_restrictions'      // User profiles with restrictions
bot_settings:     'id, bot_id, person_id, key, value'        // Bot configuration per user
pending_changes:  'id, person_id, entity_type, entity_id, timestamp, synced'  // Sync queue (unused)
backups:          'id, person_id, timestamp, size, auto'     // Backup metadata
```

**Schema Versions:**
- v1 - Initial schema
- v2 - Adds `dietary_restrictions` to profile table; auto-migration on app load

**File Storage:**
- Browser download only (no server uploads)
- JSON export/import via `src/pages/BackupExport.jsx`
- Uses `dexie-export-import` ^4.1.4 for database serialization

**Caching:**
- Service Worker (Workbox) - Caches all static assets
- Strategy: CacheFirst for Google Fonts with 1-year expiration
- Patterns: `**/*.{js,css,html,ico,png,svg,woff2}`
- No server-side caching (static hosting only)

## Authentication & Identity

**Auth Provider:**
- None - No authentication system
- Two-person household system: Elvis and Alberina
- Profile switching via React Context: `src/context/UserContext.jsx`
- User selection persisted to `localStorage` with key: `derStilleHelfer_activeUser`
- Per-user data isolation via `person_id` foreign key in all tables

**User Profiles:**
- `elvis` - ID, emoji üë®‚Äçüç≥, accent color #3b82f6 (blue)
- `alberina` - ID, emoji üë©, accent color #ec4899 (pink)

## Monitoring & Observability

**Error Tracking:**
- None configured - No external error tracking service
- Error boundary: `src/components/ErrorFallback.jsx` with `react-error-boundary`

**Logs:**
- Browser console only via `console.log()` and `console.error()`
- SW registration logs in `src/App.jsx` `useRegisterSW` hook

**Analytics:**
- None - No analytics or telemetry

## CI/CD & Deployment

**Hosting:**
- Not yet deployed (development phase)
- Target: Any static file hosting (Netlify, Vercel, GitHub Pages, S3)
- Requires HTTPS for full PWA functionality and service worker

**CI Pipeline:**
- None configured
- Can be added via GitHub Actions, GitLab CI, etc.

**Build Output:**
- `dist/` directory (Vite production build)
- Contains: Bundled JS, CSS, HTML, assets, and service worker manifest

**Build Commands:**
- `npm run build` - Production build with minification
- Output to: `dist/`

## Environment Configuration

**Required env vars:**
- None - Application is fully self-contained

**Secrets location:**
- Not applicable - No external services or credentials needed

**Configuration files:**
- `vite.config.js` - Build, PWA, and dev server configuration
- `package.json` - Dependencies and scripts
- `index.html` - Single HTML entry point

## Webhooks & Callbacks

**Incoming:**
- None

**Outgoing:**
- None

## PWA Integration

**Service Worker:**
- Auto-generated by `vite-plugin-pwa` ^0.19.0
- Registration type: `registerType: 'prompt'` (user controls updates)
- Update prompt component: `src/components/PWAUpdatePrompt.jsx`
- Workbox version: ^7.0.0 (via `workbox-window`)

**Manifest:**
- Generated at build-time from `vite.config.js` config
- Installable on mobile devices (Android Chrome, iOS Safari)
- Theme color: #4CAF50, Display: standalone

**Offline Capabilities:**
- Full offline functionality after initial load
- All data persisted in IndexedDB (no server sync)
- Static assets cached by service worker
- HashRouter enables offline page navigation

## Bot System (Local, No External Services)

**Bot Framework:**
- Custom local bot system in `src/bots/`
- Base class: `src/bots/Bot.js` with `id`, `name`, `icon` properties
- No external AI/ML services or API calls

**Available Bots:**
- `KochBot` (`src/bots/KochBot.js`) - Recipe safety checking for dietary restrictions
  - Checks ingredient against Elvis's restrictions (Weizen‚ÜíDinkel, Milch‚ÜíSauerrahm)
  - Restrictions defined in `src/bots/substitutions.js`

- `PlanerBot` (`src/bots/PlanerBot.js`) - Recipe suggestions based on inventory
  - Suggests recipes when specific ingredients detected (e.g., "Hackfleisch" ‚Üí meatball recipes)
  - Called from `src/pages/Uebersicht.jsx`

**Bot Configuration:**
- Stored in IndexedDB `bot_settings` table
- Per-user settings via `person_id` foreign key
- Bot registry: `src/bots/index.js`

## Backup/Restore

**Export:**
- JSON file download (browser-native via `<a download>`)
- Implementation: `src/pages/BackupExport.jsx`
- Uses `dexie-export-import` package's `exportDB()` function
- Exports entire database including all tables and user data

**Import:**
- File upload via `<input type="file">`
- Implementation: `src/pages/BackupExport.jsx`
- Uses `dexie-export-import` package's `importInto()` function
- Parses JSON and writes to IndexedDB
- No cloud storage or server involvement

**Data Retention:**
- All data stays on device (user's browser)
- User responsible for backup file management
- No automatic cloud backup configured

## Browser APIs Used

**Standard Web APIs:**
- `localStorage` - User preference storage (active user selection)
- `IndexedDB` - Main data persistence layer (via Dexie)
- `Service Worker API` - Offline caching and updates (via Workbox)
- `Fetch API` - Service worker caching (no external API calls)

**No Third-Party Network Calls:**
- No analytics trackers
- No CDN-hosted dependencies (all bundled or local)
- No external font services (except optional Google Fonts caching)
- No auth providers or API gateways

---

*Integration audit: 2026-01-24*
